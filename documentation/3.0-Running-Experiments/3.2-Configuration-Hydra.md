# 3.2. Configuration System (Hydra)

The Simplexity framework relies on [Hydra](https://hydra.cc/) for managing all aspects of experiment configuration. Hydra provides a flexible and powerful way to compose configurations from multiple sources, override parameters from the command line, and manage complex setups.

## Key Hydra Concepts Used

1.  **Configuration Files (YAML):**
    *   Configurations are primarily defined in YAML files located in the `simplexity/configs` directory and its subdirectories.
    *   The main configuration files for experiments are `experiment.yaml` and `train_model.yaml`.
    *   These main files often compose configurations from other, more specific YAML files (e.g., for data generators, models, loggers).

2.  **Structured Configurations (Dataclasses):**
    *   The framework uses Python dataclasses (e.g., `simplexity.configs.config.Config` and various `*InstanceConfig` classes) to define the schema for the configurations.
    *   Hydra instantiates these dataclasses from the YAML files, providing type checking and auto-completion benefits in your Python code.
    *   The `_target_` key in YAML files is a crucial Hydra feature. It specifies the fully qualified path to the Python class that should be instantiated with the given parameters. For example:
        ```yaml
        # In a logging config YAML
        instance:
          _target_: simplexity.logging.mlflow_logger.MLFlowLogger
          experiment_name: "MyExperiment"
          # ... other params
        ```
        This tells Hydra to create an instance of `MLFlowLogger` when the `logging.instance` part of the configuration is accessed.

3.  **Defaults List / Composition:**
    *   Hydra's `defaults` list in a YAML file allows a configuration to be built by composing several smaller, self-contained configuration files (config groups).
    *   Example from `experiment.yaml`:
        ```yaml
        defaults:
          - _self_  # Includes settings from the current file
          - generative_process@training_data_generator: mess3
          - generative_process@validation_data_generator: mess3
          - predictive_model: gru_rnn
          # ... and so on
        ```
        This means:
        *   The `training_data_generator` configuration group will be populated by the contents of `simplexity/configs/generative_process/mess3.yaml`.
        *   The `predictive_model` configuration group will be populated by `simplexity/configs/predictive_model/gru_rnn.yaml`.
    *   This promotes modularity and reusability of configuration snippets.

4.  **Command-Line Overrides:**
    *   As shown in `run_experiment_script.md`, any configuration value can be overridden from the command line.
    *   Syntax: `python script.py path.to.param=value group_name=choice_name`
    *   This is invaluable for quick experiments and scripting.

5.  **Working Directory:**
    *   By default, Hydra changes the working directory for each run to a dedicated output directory (e.g., `outputs/YYYY-MM-DD/HH-MM-SS/`).
    *   This keeps outputs from different runs isolated.
    *   Inside your code, you can use `hydra.utils.get_original_cwd()` to get the original directory from which the script was launched and `hydra.utils.to_absolute_path()` to resolve paths relative to the original working directory.

6.  **Sweepers (e.g., Optuna):**
    *   Hydra integrates with sweepers to perform hyperparameter optimization.
    *   The `experiment.yaml` is pre-configured to use the Optuna sweeper (`override hydra/sweeper: optuna`).
    *   You define parameter search spaces in the YAML, and Hydra (with Optuna) will launch multiple runs to explore these spaces.

## Navigating Configurations

*   Start with `experiment.yaml` or `train_model.yaml`.
*   Look at the `defaults` list to understand which other files are being included.
*   Explore the subdirectories in `simplexity/configs` (e.g., `predictive_model`, `generative_process`) to see the available choices and their specific parameters.
*   Examine the corresponding Python dataclasses in `simplexity.configs` (e.g., `simplexity.configs.predictive_model.config.py`) to understand the structure and available fields for each component.

## Benefits for Users

*   **Experimentalists:** Can easily modify experiment parameters by editing YAML files or using command-line overrides without touching Python code. They can also leverage pre-built sweep configurations.
*   **LLM Agents:** Can programmatically generate or modify YAML files to define new experiments. The structured nature and clear separation of concerns make it easier for an agent to understand which parts of the configuration to change for a desired outcome.

For a comprehensive understanding, refer to the official [Hydra Documentation](https://hydra.cc/docs/intro/). 